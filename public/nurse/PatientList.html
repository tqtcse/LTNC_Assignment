<!DOCTYPE html>
<head>
    <meta charset="utf-8">
        <title>storein4 </title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="Patientlist.css">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="./assets/img/">
</head>
<body>
  <div id="Header">  
    <div class="row">
        <div class="col-lg-2 col-6">
            <div class="Logo">
                <h1>
                    <a title="BKMEET VIETNAM" alt="BKMEET VIETNAM" href="../index1.html">BKMEET</a>
                </h1>
            </div>
        </div>
        <div class="col-lg-10 col-6">
            <div class="main-menu">
                <ul class="nav">
                    <li>
                      <a href="nurseFunctions.html">
                          Home
                          
                      </a>                  
                    </li>
                    <li>
                        <a href="AppointmentWithPatient.html">
                            My Appoinments
                           
                        </a>
                        
                    </li>
                    <li>
                        <a href="nurseDetail.html">
                            My Information
                            
                        </a>
                        
                    </li>
                    <li>
                        <a href="PatientList.html">
                            Patient List
                           
                        </a>
                        
                    </li>
                    <li id="logoutLink">
                        <a>
                          <i class="fa-solid fa-user-minus"></i>
                        </a>
                            
                        
                    </li>
                    
                </ul>
            </div>
        </div>
    </div>

    <div class="Header-line"></div>
  </div>

    <span id="weekNumberDisplay"></span>

    <div id="bg">
      <div id="all" >
          <div id="ADD">
                  <div> <h2>Add New Patient</h2></div>
              <!-- <input type="text" id="PATIENT_NAME" placeholder="Patient Name"> -->
              <div class="form-field">
                  <i class='bx bx-user'></i>
                  <input type="text" class="form-input" placeholder=" " id="PATIENT_NAME" >
                  <label for="name" class="form-label">Patient Name</label>
              </div>  
              <!-- <input type="text" id="PHONE_NUMBER" placeholder="Phone Number"> -->
              <div class="form-field">
                  <i class='bx bx-phone'></i>
                  <input type="text" class="form-input" placeholder=" " id="PHONE_NUMBER"  >
                  <label for="name" class="form-label">Phone Number</label>
              </div> 
                <!-- <input type="text" id="CLINIC" list="CLINIC_LIST" placeholder="Choose a clinic"> -->
              <div class="form-field">
                  <i class='bx bx-briefcase-alt'></i>
                  <input type="text" class="form-input" placeholder=" " id="CLINIC" list="CLINIC_LIST" >
                  <label for="name" class="form-label">Choose a clinic</label>
              </div> 
              <datalist id="CLINIC_LIST">
                  <option value="Ophthalmology">
                  <option value="Otorhinolaryngology">
                  <option value="Dermatology">
                  </option>
              </datalist>
              <!-- <input type="text" id="HealthInsuranceNumber" placeholder="HI Number"> -->
              <div class="form-field">
                  <i class='bx bx-health'></i>
                  <input type="text" class="form-input" placeholder=" " id="HealthInsuranceNumber"  >
                  <label for="name" class="form-label">HI Number</label>
              </div> 
              
              <div> <textarea id="HISTORY" placeholder="Medical Sistory" rows="4" cols="50"></textarea></div>
              <div> <textarea id="DETAILS" placeholder="Status Of Patient" rows="4" cols="50"></textarea></div>
              <div> <textarea id="RESULT" placeholder="Test Result" rows="4" cols="50"></textarea></div>
              <div><h3>Re-Examination Time</h3></div>
              <input type="date" id="RE-EXAMINATION" placeholder="Re-Examination Time">
              <!-- <input type="text" id="LOCATION" list="location_list" placeholder="Location"> -->
              <div class="form-field">
                  <i class='bx bx-location-plus'></i>
                  <input type="text" class="form-input" placeholder=" " id="LOCATION" list="location_list" >
                  <label for="name" class="form-label">Location</label>
              </div> 
              <datalist id="location_list">
                  <option value="H1">
                  <option value="H2">
                  <option value="H3">
                  </option>
              </datalist>
              <!-- <input type="text" id="TIME" list="time_list" placeholder="Time">-->
               <div class="form-field">
                  <i class='bx bxs-time'></i>
                  <input type="text" class="form-input" placeholder=" " id="TIME" list="time_list" >
                  <label for="name" class="form-label">Time</label>
              </div> 
              <datalist id="time_list">
                  <option value="8AM-10AM">
                  <option value="1PM-3PM">
                  <option value="3PM-5PM">
                  </option>
              </datalist>
              <div><button onclick="addPatient()">addPatient</button></div>
          </div>
         
          
          <div id="find">
              <h2>Find Patient In The PatientList</h2>
              
                <!-- <input type="text" id="searchInput" placeholder="Find By Phone Number"> -->
                <div class="form-field">
                  <i class='bx bx-phone'></i>
                  <input type="text" class="form-input" placeholder=" " id="searchInput" >
                  <label for="name" class="form-label"> Phone Number</label>
              </div> 
  
              <!-- <input type="text" id="CLINIC2" list="CLINIC_LIST" placeholder="Choose a clinic"> -->
              <div class="form-field">
                  <i class='bx bx-briefcase-alt'></i>
                  <input type="text" class="form-input" placeholder=" " id="CLINIC2" list="CLINIC_LIST" >
                  <label for="name" class="form-label">Choose a clinic</label>
                  </div> 
              <datalist id="CLINIC_LIST">
                  <option value="Ophthalmology">
                  <option value="Otorhinolaryngology">
                  <option value="Dermatology">
                  </option>
              </datalist>
                  <button onclick="searchPatient()">FindPatient</button>
                  <div id="patientInfo"></div>
                
          </div>
      </div>
  
  </div>




<div id="bl">
  <h1 id="sc">Appointment Scheduler</h1>
  <div id="CTWN">
        <!-- <input type="text" id="dateConvert" placeholder="Convert To Week Number"> -->
    <div class="form-field">
      <i class='bx bxs-calendar-week'></i>
      <input type="text" class="form-input" placeholder=" " id="dateConvert" >
      <label for="name" class="form-label">Convert To Week Number</label>
    </div>  
    <div id="convert"><button onclick="getWeekNumberFromDate()">Convert</button></div>
    <div id="displayConver"></div>
  </div>

  <div id="sel">
    <select id="clinicSelect" class="clinic-select select" >
      <option value="">Select Clinic</option>
      <option value="Ophthalmology">Ophthalmology</option>
      <option value="Otorhinolaryngology">Otorhinolaryngology</option>
      <option value="Dermatology">Dermatology</option>
      </select>   
      <select id="weekSelect" class="week-select select " style="display: none;"  >
      <option value="">Select a Week</option>
      </select>
      <select id="dateSelect" class="date-select select" style="display: none;"  >
      <option value="">Select a Day</option>
      <option value="Monday">Monday</option>
      <option value="Tuesday">Tuesday</option>
      <option value="Wednesday">Wednesday</option>
      <option value="Thursday">Thursday</option>
      <option value="Friday">Friday</option>
    </select>
  </div>
  <div id="scheduleContainer" style="display: none;">
    <table id="scheduleTable">
      <tr id="doctorRow">
        <th>Time Slot</th>
      </tr>
    
      </tr>
    </table>
    </div>
    <div id="saveButtonContainer" style="display: none;"><button onclick="Save()">Save List</button></div>    
</div>



<footer>
  <div class="container margin_60_35">
<div class="row">
 <div class="col-lg-4 col-md-12">
     <p>
         <a href="../index1.html" title="BKMEET ONLINE APPOINTMENT PLATFORM">
             <img src="/public/assets/img/logo.jpg" alt="BKMEET INDIA'S BEST ONLINE APPOINTMENT SCHEDULING PLATFORM" width="200" height="auto" class="img-fluid">
         </a>
     </p>
     <h5>Online Appointment Scheduling Platform</h5>
     <!-- <ul class="contacts">
         <li><a href="https://g.page/BKMEET" target="_new"><i class="fa fa-map-marker"></i>Nasscom Startup Warehouse, Infopark Campus, Kakkanad, Kerala, India</a></li>
         <li><a href="tel://+91 9496 947 548"><i class="fa fa-mobile-phone"></i>+91 9496 947 548</a></li>
         <li><a href="mailto:post@BKMEET.com"><i class="fa fa-envelope"></i>post@BKMEET.com</a></li>
     </ul> -->
     <div class="follow_us">
         <h5>Follow us</h5>
         <ul>
             <li><a href="../index1.html" target="_new"><i class="fab fa-facebook"></i></a></li>
             <li><a href="../index1.html" target="_new"><i class="fab fa-twitter"></i></a></li>
             <li><a href="../index1.html" target="_new"><i class="fab fa-linkedin"></i></a></li>
             <li><a href="../index1.html" target="_new"><i class="fab fa-instagram"></i></a></li>
             <!-- <li><a href="https://api.whatsapp.com/send?phone=919496947548&amp;text=BKMEET%20-%20Confirmed%20Online%20Appointment" target="_new"><i class="fab fa-whatsapp"></i></a></li>
             <li><a href="https://youtube.com/@BKMEET" target="_new"><i class="fab fa-youtube" target="_new"></i></a></li>
             <li><a href="https://play.google.com/store/apps/dev?id=4852298828600166862" target="_new"><i class="fab fa-android" target="_new"></i></a></li> -->
         </ul>
     </div><br>
     <!-- <p>
         <a href="https://play.google.com/store/apps/details?id=com.BKMEET.app" target="_new" title="BKMEET mobile app now available on Google playstore">
             <img src="https://www.BKMEET.com/img/bnm/google-play-badge-bnm-vc-01.svg" width="120" height="36" alt="BKMEET mobile app now available on Google playstore" class="img-fluid">
         </a>
     </p> -->
     
 </div>
 <div class="col-lg-3 col-md-4">
 
     <!-- <ul class="links">
     <li><a href="/clinicalprocedures">Clinical Procedure Scheduling</a></li>
     <li><a href="/vaccination">Vaccination</a></li>
     <li><a href="/nutritionpractice">Nutrition Practice</a></li>
     <li><a href="/compareplans">Compare Plans</a></li>
         <li><a href="/terms">Terms of Use</a></li>
         <li><a href="/privacy">Privacy Policy</a></li>
         <li><a href="/personalinformationpolicy">Personal Information Policy</a></li>
         <li><a href="/videoconsultationpolicy">Video Consultation Policy</a></li>
         <li><a href="/trademarknotice">Trade Mark Notice</a></li>
         <li><a href="/faq">FAQ</a></li>
         
         <li><a href="/limitedoffer">Special Offer</a></li>
     </ul> -->
     <p>Subscribe to BKMEET Newsletter to get Important News, Amazing Offers &amp; Inside Scoops:</p>
      <form method="post" action="" class="rd-mailform subscribe" id="subscription_mail" data-parsley-validate="" novalidate="">
          <input type="hidden" name="form-type" value="subscribe">
          <input id="email_id" name="email_id" data-parsley-trigger="change" required="" type="email" class="form-control" placeholder="Email">
          <br>
          <!-- <input type="submit" class="btn_1" value="Submit"><div class="mfInfo"></div>												  -->
      </form>
 </div>
    
 <!-- <div class="col-lg-5 col-md-5" id="homepagesection">
     <a class="btn btn-sm btn-primary" href="https://www.BKMEET.com/demo">Request BKMEET Demo</a>
     <a class="btn btn-sm btn-primary" href="https://www.BKMEET.com/career">Career@BKMEET</a>
     <a class="btn btn-sm btn-primary" href="https://www.BKMEET.com/webstories/bnm-amp-stories.html">WEBSTORIES</a>
     <h5 style="margin-top: 20px;">Your guaranteed Mobile Online Appointment</h5>
     <p>With BKMEET productivity tool, be successful in avoiding unscheduled absences. let our tool support you to be a leader in your medical practice. The best online appointment scheduling Platform enhances your practice management with online profile visibility.</p>
     
 </div> -->
 
</div>
<br><br>
<!--/row-->
<div class="row">
 <div class="col-md-12">
                   </div>
</div>
<br>
<!-- <div class="row">
 <div class="col-md-12">
 
     <p>
         <a target="_blank" href="http://www.newindianexpress.com/cities/kochi/2017/feb/08/book-n-meet-a-doctor-1568476.html"><img style="width:168px;height:21px;margin-right:25px;" alt="BKMEET startup based in Kochi featured by National media,The New IndianExpress-Startupedia" class="img-fluid" src="https://www.BKMEET.com/img/theNewIndianExpress-BKMEET-2020.png"></a>
         
         <a target="_blank" href="http://epaperbeta.timesofindia.com/Article.aspx?eid=31811&amp;articlexml=Startups-wake-up-to-new-avenues-30072017002046"><img style="width: 165px;height:21px;margin-right:25px" alt="BKMEET startup based in Kochi featured by National media,The Times of India-TOI-Startup feature by local correspondant" class="img-fluid" src="https://www.BKMEET.com/img/theTimesofIndia-BKMEET-2020.png"></a>
         
         <a target="_blank" href="https://www.vanitha.in/justin/book-in-meet-prashanthi-nadhan-article-vanitha.html"><img style="width: 127px;height:36px;" alt="BKMEET startup based in Kochi featured by National media,Vanitha-Startup feature by local correspondant" class="img-fluid" src="https://www.BKMEET.com/img/Vanitha-Manorama-BKMEET-2020.png"></a>
     
     </p>
 
 </div>

</div> -->
<hr>
<div class="row">
 <!-- <div class="col-md-8">
     <ul id="additional_links">
         <li><a href="https://qstat.co" target="_new" title="BKMEET QMS WITH TOKEN">QSTAT</a></li>
         <li><a href=" http://startups.startupmission.in/c/460" class="text-transform-none" target="_blank" title="Kerala Startup Mission Certified Startup">KSUM</a></li>
         <li><a href="https://www.startupindia.gov.in/content/sih/en/profile.Startup.59807990e4b0bed982a4ed5c.html" class="text-transform-none" target="_blank" title="Govt. of India Certified Startup">STARTUPINDIA</a></li>
     </ul>
 </div> -->
 <div class="col-md-4">
     <div id="copy">Copyright © 2024 All Rights Reserved by <a href="../index1.html">BKMEET®</a></div>
 </div>
</div>
</div>
</footer>
</body>
  
   <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
   <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
   <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
   <script src="../index1.js"></script>
<script>
    //Bill
    
    document.getElementById('logoutLink').addEventListener('click', function(){
          
          logout()
          
      })  
              firebase.auth().onAuthStateChanged(async function(user) {
                  if (user) {
                      console.log('user signed in')
                  } 
                  else {
                      console.log('user is not')
                      window.location.href = "../index1.html"
                  }
              }
              )

var currentDate = new Date();
var weekNumber = getWeekNumber(currentDate);
document.getElementById('weekNumberDisplay').innerText = "Current week: " + weekNumber;
function getWeekNumber(date) {

    var startOfYear = new Date(date.getFullYear(), 0, 1);
    var dayOfWeek = startOfYear.getDay();
    

    var firstWeekStartDate = startOfYear;
    if (dayOfWeek > 0) {
        firstWeekStartDate.setDate(1 + (7 - dayOfWeek));
    }

    var differenceInDays = Math.floor((date - firstWeekStartDate) / (24 * 60 * 60 * 1000));

    var weekNumber = Math.ceil((differenceInDays + 1) / 7) + 1;

    return weekNumber;
}
function getWeekNumberFromDate() {
  inputDate = document.getElementById('dateConvert').value
 
    var dateParts = inputDate.split('/');
    var day = parseInt(dateParts[0]);
    var month = parseInt(dateParts[1]);
    var year = parseInt(dateParts[2]);


    var date = new Date(year, month - 1, day);

    var startOfYear = new Date(date.getFullYear(), 0, 1);
    var dayOfWeek = startOfYear.getDay();
    

    var firstWeekStartDate = startOfYear;
    if (dayOfWeek > 0) {
        firstWeekStartDate.setDate(1 + (7 - dayOfWeek));
    }

    var differenceInDays = Math.floor((date - firstWeekStartDate) / (24 * 60 * 60 * 1000));

    var weekNumber = Math.floor(differenceInDays / 7) + 1;
    document.getElementById('displayConver').innerText = "Week " + weekNumber;
}
let initialTableContent = document.getElementById('scheduleTable').innerHTML;

var weekOptions = '';
for (var i = 1; i <= 52; i++) {
    weekOptions += '<option value="Week' + i + '">Week ' + i + '</option>';
}
document.getElementById('weekSelect').innerHTML = weekOptions;

document.getElementById("clinicSelect").addEventListener("change", function(){
  let selectedClinic = this.value
  let weekSelect = document.getElementById("weekSelect")
  let dateSelect = document.getElementById("dateSelect")
  let scheduleContainer = document.getElementById("scheduleContainer");
  let saveButtonContainer = document.getElementById("saveButtonContainer");

if (selectedClinic !== ""){
      weekSelect.style.display = "block"
      dateSelect.style.display = "none"
      scheduleContainer.style.display = "none"
      saveButtonContainer.style.display = "none"
} else {
        weekSelect.style.display = "none"; // Ẩn phần chọn tuần
        dateSelect.style.display = "none"; // Ẩn phần chọn ngày
        scheduleContainer.style.display = "none"; // Ẩn bảng lịch hẹn
        saveButtonContainer.style.display = "none"; // Ẩn nút "Save List"
    }

})

document.getElementById("weekSelect").addEventListener("change", function(){
  let selectedWeek = this.value
  let dateSelect = document.getElementById("dateSelect")
  let scheduleContainer = document.getElementById("scheduleContainer")
  let saveButtonContainer = document.getElementById("saveButtonContainer")

  if(selectedWeek !== ""){
        dateSelect.style.display = "block"; // Hiển thị phần chọn ngày
        scheduleContainer.style.display = "none"; // Ẩn bảng lịch hẹn
        saveButtonContainer.style.display = "none"; // Ẩn nút "Save List"
  } else {
        dateSelect.style.display = "block"; // Hiển thị phần chọn ngày
        scheduleContainer.style.display = "none"; // Ẩn bảng lịch hẹn
        saveButtonContainer.style.display = "none"; // Ẩn nút "Save List"
  }
})

document.getElementById("dateSelect").addEventListener("change", function() {
    let selectedDay = this.value;
    let scheduleContainer = document.getElementById("scheduleContainer");
    let saveButtonContainer = document.getElementById("saveButtonContainer");

    if (selectedDay !== "") {
        scheduleContainer.style.display = "block"; // Hiển thị bảng lịch hẹn khi chọn ngày
        saveButtonContainer.style.display = "block"; // Hiển thị nút "Save List"
        Clinic = document.getElementById("clinicSelect").value
        Week = document.getElementById('weekSelect').value
        Day = document.getElementById("dateSelect").value
     
        let scheduleTable = document.getElementById('scheduleTable');

    
    showDoctorName()
    PopulateTableFromFirebase()
   
  } else {
        scheduleContainer.style.display = "none"; // Ẩn bảng lịch hẹn khi không chọn ngày
        saveButtonContainer.style.display = "none"; // Ẩn nút "Save List"
    }
});
function showDoctorName() {
  
  let Clinic = document.getElementById("clinicSelect").value;
  document.getElementById('scheduleTable').innerHTML = initialTableContent;
  // Lấy số lượng bác sĩ từ cơ sở dữ liệu hoặc sử dụng một số cố định
  let numberOfDoctor = 0;

  // Lấy số lượng time slot từ form hoặc sử dụng một số cố định
  let timeSlots = [
    "8:00 AM - 10:00 AM",
    "1:00 PM - 3:00 PM",
    "3:00 PM - 5:00 PM"
  ];

  // Lặp qua từng hàng thời gian và thêm ô input cho mỗi bác sĩ
  timeSlots.forEach(function(timeSlot) {
    let tr = document.createElement('tr');
    let timeSlotTd = document.createElement('td');
    timeSlotTd.textContent = timeSlot;
    tr.appendChild(timeSlotTd);
    // document.getElementById('scheduleTable').appendChild(tr) = ''
    // Lặp qua từng bác sĩ và thêm ô nhập input cho mỗi bác sĩ
    database.ref('doctorList/' + Clinic).once('value', function(snapshot) {
      snapshot.forEach(function(childSnapshot) {
        let doctorFullName = childSnapshot.val().Full_Name;
        let doctorId = 'doctor' + childSnapshot.key;
        
        // // Tạo thẻ <td> mới
         let doctorTd = document.createElement('td');
        
        // Tạo input mới
        let input = document.createElement('input');
        input.type = 'text';
        input.className = 'input-field';
        
        // Thêm input vào thẻ <td>
        doctorTd.appendChild(input);
        
        // // Thêm thẻ <td> vào hàng 'tr'
          tr.appendChild(doctorTd);
        
        // // Nếu cần, bạn có thể thêm tên của bác sĩ vào cột thích hợp
         if (timeSlot === "8:00 AM - 10:00 AM") {
           let doctorTh = document.getElementById(doctorId);
           if (!doctorTh) { // Chỉ tạo thẻ <th> mới nếu chưa tồn tại
             doctorTh = document.createElement('th');
             doctorTh.id = doctorId;
             doctorTh.innerText = doctorFullName;
             document.getElementById('doctorRow').appendChild(doctorTh);
           }
         }
      });
    });

    document.getElementById('scheduleTable').appendChild(tr);
    
   
  });
}
let tableRows = document.getElementById("scheduleTable").rows;
let doctors = {}; // Sử dụng object thay vì mảng để lưu trữ tên bác sĩ với key là index
let initialTimeSlots = [
    "8:00 AM - 10:00 AM",
    "1:00 PM - 3:00 PM",
    "3:00 PM - 5:00 PM"
  ];

function fetchDataFromFirebase(selectedClinic, selectedWeek, selectedDay) {
    return new Promise((resolve, reject) => {
        firebase.database().ref("AppointmentWithDoctor/" + selectedClinic + "/" + selectedWeek + "/" + selectedDay).once('value')
            .then(snapshot => {
                const appointments = snapshot.val();
                //console.log(appointments)
                resolve(appointments);
            })
            .catch(error => {
                reject(error);
            });
    });
}

async function PopulateTableFromFirebase() {
  
    try {
        let selectedClinic = document.getElementById("clinicSelect").value;
        let selectedDay = document.getElementById("dateSelect").value;
        let selectedWeek = document.getElementById("weekSelect").value;
        await fetchDoctors(selectedClinic);
        const appointments = await fetchDataFromFirebase(selectedClinic, selectedWeek, selectedDay);

        // Lặp qua mỗi dòng trong bảng
        for (let i = 1; i < tableRows.length; i++) {
            let timeSlot = initialTimeSlots[i - 1];
            let rowCells = tableRows[i].cells;

            // Lấy dữ liệu cuộc hẹn cho từng ô trong hàng
            let appointmentData = appointments[timeSlot];
           // console.log(appointmentData)
            if (appointmentData) {
                for (let j = 1; j < rowCells.length; j++) {
                  console.log(doctors[rowCells.length-j])
                  rowCells[j].querySelector('input').value = appointmentData[doctors[j]]
                }
            }
        }

        console.log("Dữ liệu từ cơ sở dữ liệu Firebase đã được hiển thị trên bảng thành công!");
    } catch (error) {
        console.error("Lỗi khi lấy dữ liệu từ cơ sở dữ liệu Firebase:", error);
    }
}

function fetchDoctors(selectedClinic) {
  return new Promise((resolve, reject) => {
    database.ref('doctorList/' + selectedClinic).once('value')
      .then(snapshot => {
        let i = 0;
        snapshot.forEach(childSnapshot => {
          i++;
          doctors[i] = childSnapshot.val().Full_Name;
        });
        resolve(); // Gọi resolve() khi đã lấy xong dữ liệu từ Firebase
      })
      .catch(error => {
        reject(error); // Trả về lỗi nếu có lỗi xảy ra trong quá trình lấy dữ liệu
      });
  });
}
async function Save() {

  try {
    let selectedClinic = document.getElementById("clinicSelect").value;
    await fetchDoctors(selectedClinic); // Chờ cho dữ liệu từ Firebase được lấy xong

    let selectedDay = document.getElementById("dateSelect").value;
    let selectedWeek = document.getElementById("weekSelect").value;
    let appointments = {}; // Mảng chứa thông tin của tất cả các cuộc hẹn

    for (let i = 1; i < tableRows.length; i++) {
      let timeSlot = initialTimeSlots[i - 1];
      let doctorsData = []; // Mảng chứa thông tin của các bác sĩ cho thời gian hiện tại

      // Lặp qua từng ô trong hàng hiện tại để lấy dữ liệu của các bác sĩ
      let rowCells = tableRows[i].cells;
      for (let j = 1; j < rowCells.length; j++) {
        let doctorInput = rowCells[j].querySelector('input');
        if (doctorInput) {
          //console.log(doctors[j])
          doctorsData[doctors[j]] = doctorInput.value;
        }
      }

      // Tạo đối tượng bác sĩ với tên bác sĩ và lưu vào mảng
      appointments[timeSlot] = doctorsData;
    }

    // Lưu mảng thông tin cuộc hẹn vào cơ sở dữ liệu Firebase
    firebase.database().ref("AppointmentWithDoctor/" + selectedClinic + "/" + selectedWeek + "/" + selectedDay).set(appointments)
      .then(() => {
        console.log("Dữ liệu đã được lưu vào cơ sở dữ liệu Firebase!");
      })
      .catch((error) => {
        console.error("Lỗi khi lưu dữ liệu vào cơ sở dữ liệu Firebase:", error);
      });
  } catch (error) {
    console.error("Lỗi khi lấy dữ liệu từ cơ sở dữ liệu Firebase:", error);
  }
}
function deleteList(){
  PhoneNumber = document.getElementById("searchInput").value 
  if(PhoneNumber === ''){
    return
  }
  else {
  database.ref('Appointment').orderByChild('PhoneNumber').equalTo(PhoneNumber).once('value')
  .then((snapshot)=>{
    database.ref('Appointment/' + PhoneNumber).remove()
    console.log('delete success')
    AppointmentTable()
  })
}
}

    function BillSubmit(){
        idBill = document.getElementById("IdBill").value
        Price = document.getElementById("Price").value
        Clinic = document.getElementById("CLINIC3").value
        detailBill = document.getElementById("detailBill").value
        PhoneNumber = document.getElementById("PhoneBill").value
        Dates = document.getElementById("Date").value
                var data = {
                    IdBill : idBill,
                    Price : Price,
                    DetailBill : detailBill,
                    Clinic : Clinic,
                    PhoneNumber : PhoneNumber,
                    Date: Dates,
                    Status : "No"
                }
                
                firebase.database().ref('Bill/' + Clinic + '/' + PhoneNumber + '/' + idBill ).set(data)
                console.log('submitBill')
            
            
        }
    
    







    function searchPatient(){
    searchInput = document.getElementById('searchInput').value;
    patientListRef = database.ref('patientList');
    Clinic = document.getElementById("CLINIC2").value
    
    console.log(searchInput)
    console.log(Clinic)

    database.ref('patientList/' + Clinic).orderByChild('PhoneNumber').equalTo(searchInput).once('value')
      .then((snapshot) => {
       
        const patients = snapshot.val();
        if (patients) {
            //xóa thông tin của bệnh nhân trước đó 
            const patientInfoDiv = document.getElementById('patientInfo');
            patientInfoDiv.innerHTML = ''; // Xóa nội dung của phần tử

            //tìm kiếm từng bệnh nhân
            snapshot.forEach((childSnapshot) => {
                const patient = childSnapshot.val(); 
                const patientInfoDiv = document.getElementById('patientInfo');
                const patientDiv = document.createElement('div');
                patientDiv.innerHTML = `<p>FullName: ${patient.FullName}</p>
                                        <p>PhoneNumber: ${patient.PhoneNumber}</p>
                                        <p>Clinic: ${patient.Clinic}</p>
                                        <p>MedicalHistory: ${patient.MedicalHistory}</p>
                                        <p>Status: ${patient.Status}</p>
                                        <p>Status: ${patient.TestResult}</p>
                                        <p>Location: ${patient.Location}</p>
                                        <p>Time: ${patient.Time}</p>
                                        <p>DateMeet: ${patient.Date}</p>
                                        <p>HealthInsuranceNumber: ${patient.HealthInsuranceNumber}</p>`;
                                        
                patientInfoDiv.appendChild(patientDiv);
                
             

               

                const hideButton = document.createElement('button')
                hideButton.textContent = 'Hide Patient'
                hideButton.addEventListener('click', () =>{

                    patientInfoDiv.innerHTML = ''
                    document.getElementById('searchInput').value = ''
                    document.getElementById('CLINIC2').value = ''

                })
                patientInfoDiv.appendChild(hideButton)
            });
          
       
          console.log("Bệnh nhân được tìm thấy:");
         
          console.log(patients);
        } 
        else {
          console.log("Không tìm thấy bệnh nhân có tên là");
        }
      })
      .catch((error) => {
        console.error("Lỗi khi tìm kiếm bệnh nhân:", error);
      });
  
};

function addPatient(){
    FullName = document.getElementById('PATIENT_NAME').value
    PhoneNumber = document.getElementById('PHONE_NUMBER').value
    Clinic = document.getElementById("CLINIC").value
    Status = document.getElementById("DETAILS").value
    DateMeet = document.getElementById("RE-EXAMINATION").value
    locationToMeet = document.getElementById("LOCATION").value
    MedicalHistory = document.getElementById("HISTORY").value
    Result = document.getElementById("RESULT").value
    TimeClock = document.getElementById('TIME').value
    HIs = document.getElementById('HealthInsuranceNumber').value

    const patientRef = firebase.database().ref('patientList')
    patientRef.once('value', (snapshot) => {
        if (!snapshot.exists()) {
            var data = {
                    FullName : FullName,
                    PhoneNumber : PhoneNumber,
                    Clinic : Clinic,
                    Status : Status,
                    Date : DateMeet,
                    Location : locationToMeet,
                    MedicalHistory : MedicalHistory,
                    TestResult : Result,
                    Time : TimeClock,
                    HealthInsuranceNumber : HIs,

    }
        console.log('No patientList found. Creating new patientList...');
        firebase.database().ref('patientList/' + Clinic + '/' + PhoneNumber).set(data); // Tạo mới patientList nếu không tồn tại
    }
        snapshot.forEach((clinicSnapshot) =>{
            clinicSnapshot.forEach((childSnapshot) => {
                if(locationToMeet === childSnapshot.val().Location && DateMeet === childSnapshot.val().Date && TimeClock === childSnapshot.val().Time ){
                    console.log('Room isnt ready')
                    return
                }
                else{
                    var data = {
                    FullName : FullName,
                    PhoneNumber : PhoneNumber,
                    Clinic : Clinic,
                    Status : Status,
                    Date : DateMeet,
                    Location : locationToMeet,
                    MedicalHistory : MedicalHistory,
                    TestResult : Result,
                    Time : TimeClock,
                    HealthInsuranceNumber : HIs,
    }
    console.log(Clinic)
    console.log(PhoneNumber)
    firebase.database().ref('patientList/' + Clinic + '/' + PhoneNumber).set(data)
    .then(()=>{
        console.log('Add Patient Successfully')
    }
    )
                }

            })
        })
    })


}    




   </script>
</html>
