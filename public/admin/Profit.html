<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="Profit.css">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <div id="Header">
        <div class="row">
            <div class="col-lg-2 col-6">
                <div class="Logo">
                    <h1>
                        <a title="BKMEET" alt="BKMEET VIETNAM" href="../index1.html">BKMEET</a>
                    </h1>
                </div>
            </div>
            <div class="col-lg-10 col-6">
                <div class="main-menu">
                    <ul class="nav">
                        <li> <b>ADMIN</b>
                        </li>
                        <li>
                            <a href="adminFunctions.html">
                                Home
                                <small>Main</small>
                            </a>
                            
                        </li>
                        <li>
                            <a href="makeAdmin.html">Create Account
                                <small>Account</small>
                            </a>
                            
                        </li>
                        <li>
                            <a href="upMedicine.html">Upload Medicine
                                <small>Medicine</small>
                            </a>
                              
                        </li>
                        <li>
                            <a href="upTool.html">Upload Tool
                                <small>Tool</small>
                            </a>
                              
                        </li>
                        <li>
                            <a href="StaffList.html">Staff List
                                <small>Staff</small>
                            </a>
                           
                        </li>
                        <li>
                            <a href="Profit.html">Profit
                                <small>Profit</small>
                            </a>
                           
                        </li>
                        <!-- <li>
                            <a href="home.html">
                                <i class="fa-solid fa-user-minus"></i>
                            </a>
                        </li> -->
                        
                    </ul>
                </div>
            </div>

        </div>

        <div class="Header-line">
        </div>
    </div>

    <div id="bg">
        <div id="bg1">
            <span id="weekNumberDisplay"></span>
        <div id="all"> 
              <!-- <input type="number" id="weekNumber" placeholder="Week Number"> -->
            <div id="WD">
            <div class="form-field">
                <input type="number" class="form-input" placeholder=" " id="weekNumber"  >
                <label for="name" class="form-label">Week Number</label>
            </div> 
            </div>
        <div><button onclick="ShowWeekData()">Show Week Data</button></div>
        <div><button onclick="getData()">Show All Data</button></div></div>
        
        <div>
            <canvas id="WeekProfitChart" width="300" height="300" style="display: none;"></canvas>
            <div id="ProfitDiv"></div>
            <canvas id="WeekCostChart" width="300" height="300" style="display: none;"></canvas>
            <div id="CostDiv"></div>
        </div>
        <div id="Chart">
            <div id="Chart1">
                <canvas id="myPieChart" width="300" height="300" style="display: none;"></canvas>
                <div id="TotalDiv"></div>
            </div>
            <div id="Chart2">
                <canvas id="myPieChartCost" width="300" height="300" style="display: none;"></canvas>
                <div id="TotalCostDiv"></div>
            </div>
    
        </div>
        </div>
        
    </div>


    <footer>
        <div class="container margin_60_35">
    <div class="row">
       <div class="col-lg-4 col-md-12">
           <p>
               <a href="../index1.html" title="BKMEET ONLINE APPOINTMENT PLATFORM">
                   <img src="/public/assets/img/logo.jpg" alt="BKMEET INDIA'S BEST ONLINE APPOINTMENT SCHEDULING PLATFORM" width="200" height="auto" class="img-fluid">
               </a>
           </p>
           <h5>Online Appointment Scheduling Platform</h5>
           <!-- <ul class="contacts">
               <li><a href="https://g.page/BKMEET" target="_new"><i class="fa fa-map-marker"></i>Nasscom Startup Warehouse, Infopark Campus, Kakkanad, Kerala, India</a></li>
               <li><a href="tel://+91 9496 947 548"><i class="fa fa-mobile-phone"></i>+91 9496 947 548</a></li>
               <li><a href="mailto:post@BKMEET.com"><i class="fa fa-envelope"></i>post@BKMEET.com</a></li>
           </ul> -->
           <div class="follow_us">
               <h5>Follow us</h5>
               <ul>
                   <li><a href="../index1.html" target="_new"><i class="fab fa-facebook"></i></a></li>
                   <li><a href="../index1.html" target="_new"><i class="fab fa-twitter"></i></a></li>
                   <li><a href="../index1.html" target="_new"><i class="fab fa-linkedin"></i></a></li>
                   <li><a href="../index1.html" target="_new"><i class="fab fa-instagram"></i></a></li>
                   <!-- <li><a href="https://api.whatsapp.com/send?phone=919496947548&amp;text=BKMEET%20-%20Confirmed%20Online%20Appointment" target="_new"><i class="fab fa-whatsapp"></i></a></li>
                   <li><a href="https://youtube.com/@BKMEET" target="_new"><i class="fab fa-youtube" target="_new"></i></a></li>
                   <li><a href="https://play.google.com/store/apps/dev?id=4852298828600166862" target="_new"><i class="fab fa-android" target="_new"></i></a></li> -->
               </ul>
           </div><br>
           <!-- <p>
               <a href="https://play.google.com/store/apps/details?id=com.BKMEET.app" target="_new" title="BKMEET mobile app now available on Google playstore">
                   <img src="https://www.BKMEET.com/img/bnm/google-play-badge-bnm-vc-01.svg" width="120" height="36" alt="BKMEET mobile app now available on Google playstore" class="img-fluid">
               </a>
           </p> -->
           
       </div>
       <div class="col-lg-3 col-md-4">
       
           <!-- <ul class="links">
           <li><a href="/clinicalprocedures">Clinical Procedure Scheduling</a></li>
           <li><a href="/vaccination">Vaccination</a></li>
           <li><a href="/nutritionpractice">Nutrition Practice</a></li>
           <li><a href="/compareplans">Compare Plans</a></li>
               <li><a href="/terms">Terms of Use</a></li>
               <li><a href="/privacy">Privacy Policy</a></li>
               <li><a href="/personalinformationpolicy">Personal Information Policy</a></li>
               <li><a href="/videoconsultationpolicy">Video Consultation Policy</a></li>
               <li><a href="/trademarknotice">Trade Mark Notice</a></li>
               <li><a href="/faq">FAQ</a></li>
               
               <li><a href="/limitedoffer">Special Offer</a></li>
           </ul> -->
           <p>Subscribe to BKMEET Newsletter to get Important News, Amazing Offers &amp; Inside Scoops:</p>
            <form method="post" action="" class="rd-mailform subscribe" id="subscription_mail" data-parsley-validate="" novalidate="">
                <input type="hidden" name="form-type" value="subscribe">
                <input id="email_id" name="email_id" data-parsley-trigger="change" required="" type="email" class="form-control" placeholder="Email">
                <br>
                <!-- <input type="submit" class="btn_1" value="Submit"><div class="mfInfo"></div>												  -->
            </form>
       </div>
          
       <!-- <div class="col-lg-5 col-md-5" id="homepagesection">
           <a class="btn btn-sm btn-primary" href="https://www.BKMEET.com/demo">Request BKMEET Demo</a>
           <a class="btn btn-sm btn-primary" href="https://www.BKMEET.com/career">Career@BKMEET</a>
           <a class="btn btn-sm btn-primary" href="https://www.BKMEET.com/webstories/bnm-amp-stories.html">WEBSTORIES</a>
           <h5 style="margin-top: 20px;">Your guaranteed Mobile Online Appointment</h5>
           <p>With BKMEET productivity tool, be successful in avoiding unscheduled absences. let our tool support you to be a leader in your medical practice. The best online appointment scheduling Platform enhances your practice management with online profile visibility.</p>
           
       </div> -->
       
    </div>
    <br><br>
    <!--/row-->
    <div class="row">
       <div class="col-md-12">
                         </div>
    </div>
    <br>
    <!-- <div class="row">
       <div class="col-md-12">
       
           <p>
               <a target="_blank" href="http://www.newindianexpress.com/cities/kochi/2017/feb/08/book-n-meet-a-doctor-1568476.html"><img style="width:168px;height:21px;margin-right:25px;" alt="BKMEET startup based in Kochi featured by National media,The New IndianExpress-Startupedia" class="img-fluid" src="https://www.BKMEET.com/img/theNewIndianExpress-BKMEET-2020.png"></a>
               
               <a target="_blank" href="http://epaperbeta.timesofindia.com/Article.aspx?eid=31811&amp;articlexml=Startups-wake-up-to-new-avenues-30072017002046"><img style="width: 165px;height:21px;margin-right:25px" alt="BKMEET startup based in Kochi featured by National media,The Times of India-TOI-Startup feature by local correspondant" class="img-fluid" src="https://www.BKMEET.com/img/theTimesofIndia-BKMEET-2020.png"></a>
               
               <a target="_blank" href="https://www.vanitha.in/justin/book-in-meet-prashanthi-nadhan-article-vanitha.html"><img style="width: 127px;height:36px;" alt="BKMEET startup based in Kochi featured by National media,Vanitha-Startup feature by local correspondant" class="img-fluid" src="https://www.BKMEET.com/img/Vanitha-Manorama-BKMEET-2020.png"></a>
           
           </p>
       
       </div>
    
    </div> -->
    <hr>
    <div class="row">
       <!-- <div class="col-md-8">
           <ul id="additional_links">
               <li><a href="https://qstat.co" target="_new" title="BKMEET QMS WITH TOKEN">QSTAT</a></li>
               <li><a href=" http://startups.startupmission.in/c/460" class="text-transform-none" target="_blank" title="Kerala Startup Mission Certified Startup">KSUM</a></li>
               <li><a href="https://www.startupindia.gov.in/content/sih/en/profile.Startup.59807990e4b0bed982a4ed5c.html" class="text-transform-none" target="_blank" title="Govt. of India Certified Startup">STARTUPINDIA</a></li>
           </ul>
       </div> -->
       <div class="col-md-4">
           <div id="copy">Copyright © 2024 All Rights Reserved by <a href="../index1.html">BKMEET®</a></div>
       </div>
    </div>
    </div>
    </footer>
    


</body>

<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="../index1.js"></script>

<script>

    function ShowWeekData(){
        
        let profitData = {}
        let costData = {}

        WeekNumber = document.getElementById('weekNumber').value 

        database.ref('Revenue').once('value', function(snapshot){
            
            totalsumProfit = 0
            totalsumCost = 0
            
            snapshot.forEach((childSnapshot) => {
                sumProfit = 0
            sumCost = 0
               
                database.ref('Revenue/' + childSnapshot.key + '/' + WeekNumber).once('value', function(snapshots){
                    console.log(childSnapshot.key)
                    snapshots.forEach((childSnapshots) => {
                       
                        //console.log(childSnapshots.val())
                        if(childSnapshots.val().Profit != null){

                            dataProfit = childSnapshots.val().Profit
                            sumProfit = sumProfit + dataProfit
                            totalsumProfit =  totalsumProfit + dataProfit
                            
                            profitData[childSnapshot.key] = dataProfit
                            
                            

                        } else {

                            dataCost = childSnapshots.val().Cost
                            sumCost = sumCost + dataCost
                            totalsumCost = totalsumCost + dataCost
                            //console.log(sumCost)

                            costData[childSnapshot.key] = dataCost
                            
                            //console.log(profitDatas['Ophthalmology'])
                        }             

                    })
                   
                    //console.log(costData[childSnapshot.key])              
                    if(profitData['Ophthalmology'] != null && profitData['Dermatology'] != null && profitData['Otorhinolaryngology'] != null){
                        console.log(totalsumCost)
                        console.log(totalsumProfit)
                        drawChart(profitData['Ophthalmology'],profitData['Otorhinolaryngology'],profitData['Dermatology'], totalsumProfit)
                        drawChartCost(costData['Ophthalmology'],costData['Otorhinolaryngology'],costData['Dermatology'], totalsumCost)
                    }
                })
                

                

            })

        })

    }


    function getData(){

        let profitData = {}
        let costData = {}

        database.ref('Revenue').once('value',function(snapshot){
            totalsumProfit = 0
            totalsumCost = 0

            snapshot.forEach((childSnapshot) => {
                sumProfit = 0
                sumCost = 0
                console.log(childSnapshot.key)
               // console.log(childSnapshot.val())
                childSnapshot.forEach((childSnapshot2) => {
                    //console.log(childSnapshot2.val())
                    childSnapshot2.forEach((childSnapshot3) => {
                        dataProfit = childSnapshot3.val().Profit
                        if(dataProfit !=  null){
                            //console.log(childSnapshot3.val().Profit)
                            sumProfit = sumProfit + dataProfit
                            totalsumProfit =  totalsumProfit + dataProfit
                        } else {
                            dataCost = childSnapshot3.val().Cost
                            sumCost = sumCost + dataCost
                            totalsumCost = totalsumCost + dataCost
                        }
                        
                    })
                   
                })
                
                costData[childSnapshot.key] = sumCost

                profitData[childSnapshot.key] = sumProfit

                console.log(costData[childSnapshot.key])
                //console.log(totalsumProfit)
                
            })

            drawChart(profitData['Ophthalmology'],profitData['Otorhinolaryngology'],profitData['Dermatology'], totalsumProfit)
            drawChartCost(costData['Ophthalmology'],costData['Otorhinolaryngology'],costData['Dermatology'], totalsumCost)
            
            
        })
    }


var myPieChartCost
var myPieChart

function drawChartCost(Ophthalmology, Otorhinolaryngology, Dermatology, Total) {
    var ctx = document.getElementById('myPieChartCost').getContext('2d');

    // Hủy bỏ thể hiện biểu đồ cũ nếu tồn tại
    if (window.myPieChartCost) {
        window.myPieChartCost.destroy();
    }

    // Tiếp tục với việc vẽ biểu đồ mới
    document.getElementById("myPieChartCost").style.display = 'block';
    document.getElementById("TotalCostDiv").innerText = "Total Medicine Cost: " + Total;

    var data = {
        labels: ['Ophthalmology', 'Otorhinolaryngology', 'Dermatology'],
        datasets: [{
            label: 'Cost',
            data: [Ophthalmology, Otorhinolaryngology, Dermatology],
            backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)'
            ],
            borderWidth: 1
        }]
    };

    window.myPieChartCost = new Chart(ctx, {
        type: 'pie',
        data: data,
        options: {
            responsive: false,
            maintainAspectRatio: false,
            width: 10,
            height: 10
        }
    });
}



function drawChart(Ophthalmology, Otorhinolaryngology, Dermatology, Total) {
    // Lấy canvas
    var ctx = document.getElementById('myPieChart').getContext('2d');
    
    // Kiểm tra nếu có biểu đồ cũ, hủy nó trước khi vẽ biểu đồ mới
    if (window.myPieChart != null) {
        window.myPieChart.destroy();
    }

    // Hiển thị phần tử chứa biểu đồ
    document.getElementById("myPieChart").style.display = 'block';
    document.getElementById("TotalDiv").innerText = "Total Profit : " + Total;

    // Tạo dữ liệu cho biểu đồ (ví dụ)
    var data = {
        labels: ['Ophthalmology', 'Otorhinolaryngology', 'Dermatology'],
        datasets: [{
            label: 'Profit',
            data: [Ophthalmology, Otorhinolaryngology, Dermatology],
            backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)'
            ],
            borderWidth: 1
        }]
    };

    // Tạo và cấu hình biểu đồ tròn
    window.myPieChart = new Chart(ctx, {
        type: 'pie',
        data: data,
        options: {
            responsive: false, // Không tự động điều chỉnh kích thước
            maintainAspectRatio: false, // Không giữ tỷ lệ khung hình
            width: 10, // Độ rộng của biểu đồ
            height: 10 // Độ cao của biểu đồ
        }
    });
}


</script>
</html>